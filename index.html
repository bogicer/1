<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>Онлайн Газета</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 900px; margin: auto; padding: 20px; }
  #cabinet, #login { display: none; margin-top: 20px; }
  article { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; border-radius: 5px; }
  img { max-width: 300px; border-radius: 5px; }
  button { margin-right: 5px; }
</style>
</head>
<body>

<header>
  <h1>Онлайн Газета</h1>
  <nav>
    <button onclick="showPage('home')">Головна</button>
    <button onclick="showPage('cabinet')">Кабінет</button>
  </nav>
</header>

<section id="login">
  <h2>Вхід до кабінету</h2>
  <form id="loginForm">
    <input type="text" id="username" placeholder="Логін" required>
    <input type="password" id="password" placeholder="Пароль" required>
    <button type="submit">Увійти</button>
  </form>
</section>

<section id="home">
  <h2>Статті</h2>
  <div id="articles"></div>
</section>

<section id="cabinet">
  <h2 id="formTitle">Додати статтю</h2>
  <form id="articleForm">
    <input type="text" id="title" placeholder="Заголовок" required><br><br>
    <textarea id="content" placeholder="Текст статті" rows="6" required></textarea><br><br>
    <input type="text" id="author" placeholder="Автор" required><br><br>
    <input type="file" id="image" accept="image/*"><br><br>
    <img id="preview" src="" style="display:none;"><br>
    <button type="submit">Опублікувати</button>
  </form>
  <button onclick="clearArticles()" style="margin-top:15px; background:#d90429; color:white;">Очистити всі статті</button>
</section>

<script>
let editIndex = null;
const users = [
  {username: "admin", password: "1234"},
  {username: "editor", password: "qwerty"}
];

document.getElementById("loginForm").addEventListener("submit", function(e){
  e.preventDefault();
  const username = document.getElementById("username").value;
  const password = document.getElementById("password").value;
  const user = users.find(u => u.username === username && u.password === password);
  if(user){
    localStorage.setItem("loggedUser", username);
    alert("Вхід успішний!");
    showPage("home");
    loadArticles();
  } else {
    alert("Невірний логін або пароль");
  }
});

function showPage(page) {
  const loggedUser = localStorage.getItem("loggedUser");
  if(page === "cabinet" && !loggedUser){
    alert("Спочатку увійдіть до кабінету!");
    page = "login";
  }
  document.getElementById("home").style.display = (page==="home")?"block":"none";
  document.getElementById("cabinet").style.display = (page==="cabinet")?"block":"none";
  document.getElementById("login").style.display = (page==="login")?"block":"none";
}

// Logout button
if(!document.getElementById("logoutBtn")){
  const btn = document.createElement("button");
  btn.id = "logoutBtn";
  btn.textContent = "Вийти";
  btn.style.marginLeft = "15px";
  btn.onclick = () => {
    localStorage.removeItem("loggedUser");
    alert("Ви вийшли з кабінету!");
    showPage("login");
  };
  document.querySelector("header nav").appendChild(btn);
}

document.getElementById("image").addEventListener("change", function(){
  const file = this.files[0];
  const preview = document.getElementById("preview");
  if(file){
    const reader = new FileReader();
    reader.onload = function(e){
      preview.src = e.target.result;
      preview.style.display = "block";
    }
    reader.readAsDataURL(file);
  } else {
    preview.src = "";
    preview.style.display = "none";
  }
});

document.getElementById("articleForm").addEventListener("submit", function(e){
  e.preventDefault();
  const title = document.getElementById("title").value;
  const content = document.getElementById("content").value;
  const author = document.getElementById("author").value;
  const time = new Date().toLocaleString();
  const imgFile = document.getElementById("preview").src || "";
  saveArticle(title, content, author, time, imgFile);
});

function saveArticle(title, content, author, time, image){
  let articles = JSON.parse(localStorage.getItem("articles")) || [];
  if(editIndex !== null){
    articles[editIndex] = {title, content, author, time, image: image || articles[editIndex].image};
    editIndex = null;
    document.getElementById("formTitle").textContent = "Додати статтю";
  } else {
    articles.unshift({title, content, author, time, image});
  }
  localStorage.setItem("articles", JSON.stringify(articles));
  document.getElementById("articleForm").reset();
  document.getElementById("preview").style.display = "none";
  showPage("home");
  loadArticles();
}

function loadArticles(){
  const container = document.getElementById("articles");
  container.innerHTML = "";
  const articles = JSON.parse(localStorage.getItem("articles")) || [];
  articles.forEach((art, i)=>{
    const div = document.createElement("article");
    div.innerHTML = `
      <h3>${art.title}</h3>
      <p><em>${art.author} - ${art.time}</em></p>
      ${art.image?`<img src="${art.image}"><br>`:""}
      <p>${art.content}</p>
      <button onclick="editArticle(${i})">Редагувати</button>
      <button onclick="deleteArticle(${i})" style="background:#d90429;color:white;">Видалити</button>
    `;
    container.appendChild(div);
  });
}

function editArticle(i){
  const articles = JSON.parse(localStorage.getItem("articles")) || [];
  const art = articles[i];
  document.getElementById("title").value = art.title;
  document.getElementById("content").value = art.content;
  document.getElementById("author").value = art.author;
  if(art.image){
    const preview = document.getElementById("preview");
    preview.src = art.image;
    preview.style.display = "block";
  }
  editIndex = i;
  showPage("cabinet");
  document.getElementById("formTitle").textContent = "Редагувати статтю";
}

function deleteArticle(i){
  let articles = JSON.parse(localStorage.getItem("articles")) || [];
  if(confirm("Видалити цю статтю?")){
    articles.splice(i,1);
    localStorage.setItem("articles", JSON.stringify(articles));
    loadArticles();
  }
}

function clearArticles(){
  if(confirm("Видалити всі статті?")){
    localStorage.removeItem("articles");
    loadArticles();
  }
}

showPage("login");
</script>

</body>
</html>
