<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>–û–Ω–ª–∞–π–Ω –ì–∞–∑–µ—Ç–∞</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; margin:0; }
    header { background:#222; color:#fff; padding:15px; text-align:center; }
    nav { background:#444; color:#fff; padding:10px; text-align:center; }
    nav button { margin: 0 5px; padding: 8px 12px; border:none; border-radius:5px; cursor:pointer; }
    nav button:hover { background:#666; color:#fff; }
    .container { max-width: 800px; margin:20px auto; background:#fff; padding:20px; border-radius:10px; }
    article { border-bottom:1px solid #ddd; padding:15px 0; }
    article img { max-width:100%; border-radius:10px; }
    .meta { font-size:12px; color:gray; }
    .hidden { display:none; }
  </style>
</head>
<body>
<header>
  <h1>–û–Ω–ª–∞–π–Ω –ì–∞–∑–µ—Ç–∞</h1>
</header>
<nav>
  <button onclick="showPage('home')">üè† –ì–æ–ª–æ–≤–Ω–∞</button>
  <button onclick="showPage('login')">üîë –ö–∞–±—ñ–Ω–µ—Ç</button>
</nav>

<div class="container">

  <!-- –ì–æ–ª–æ–≤–Ω–∞ -->
  <section id="home">
    <h2>–°—Ç–∞—Ç—Ç—ñ</h2>
    <div id="articles"></div>
  </section>

  <!-- –õ–æ–≥—ñ–Ω -->
  <section id="login" class="hidden">
    <h2>–í—Ö—ñ–¥</h2>
    <input type="text" id="username" placeholder="–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á"><br><br>
    <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å"><br><br>
    <button onclick="login()">–£–≤—ñ–π—Ç–∏</button>
  </section>

  <!-- –ö–∞–±—ñ–Ω–µ—Ç -->
  <section id="cabinet" class="hidden">
    <h2>–ö–∞–±—ñ–Ω–µ—Ç</h2>
    <form id="articleForm">
      <input type="text" id="title" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫" required><br><br>
      <textarea id="content" placeholder="–¢–µ–∫—Å—Ç —Å—Ç–∞—Ç—Ç—ñ" rows="5" required></textarea><br><br>
      <input type="text" id="author" placeholder="–ê–≤—Ç–æ—Ä" required><br><br>
      <input type="file" id="image" accept="image/*"><br>
      <img id="preview" class="hidden"><br><br>
      <button type="submit">–û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏</button>
    </form>
    <h3>–í–∞—à—ñ —Å—Ç–∞—Ç—Ç—ñ</h3>
    <div id="myArticles"></div>
  </section>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js"></script>

<script>
  // üîπ –¢–í–û–á –î–ê–ù–Ü FIREBASE
  // Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyCP0ris9jVmQG4ffRWzDccmuDU8u02640E",
  authDomain: "vistochka-1.firebaseapp.com",
  databaseURL: "https://vistochka-1-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "vistochka-1",
  storageBucket: "vistochka-1.firebasestorage.app",
  messagingSenderId: "275110723807",
  appId: "1:275110723807:web:65c7248f3abb716e06696a",
  measurementId: "G-RC2TQW819P"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
  };
  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // üîπ –ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–æ–∫
  function showPage(page) {
    document.querySelectorAll("section").forEach(s => s.classList.add("hidden"));
    document.getElementById(page).classList.remove("hidden");
    if (page === "home") loadArticles();
    if (page === "cabinet") loadMyArticles();
  }

  // üîπ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è (–¥—É–∂–µ –ø—Ä–æ—Å—Ç–∞, –º–æ–∂–Ω–∞ –¥–æ—Ä–æ–±–∏—Ç–∏ Firebase Auth)
  let loggedIn = false;
  function login() {
    const u = document.getElementById("username").value;
    const p = document.getElementById("password").value;
    if (u==="admin" && p==="1234") {
      loggedIn = true;
      showPage("cabinet");
    } else {
      alert("–ù–µ–≤—ñ—Ä–Ω–∏–π –ª–æ–≥—ñ–Ω –∞–±–æ –ø–∞—Ä–æ–ª—å!");
    }
  }

  // üîπ –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥ —Ñ–æ—Ç–æ
  document.getElementById("image").addEventListener("change", function(){
    const file = this.files[0];
    const preview = document.getElementById("preview");
    if (file) {
      const reader = new FileReader();
      reader.onload = e => { preview.src = e.target.result; preview.classList.remove("hidden"); };
      reader.readAsDataURL(file);
    } else {
      preview.src = "";
      preview.classList.add("hidden");
    }
  });

  // üîπ –î–æ–¥–∞–≤–∞–Ω–Ω—è —Å—Ç–∞—Ç—Ç—ñ —É Firebase
  document.getElementById("articleForm").addEventListener("submit", async (e)=>{
    e.preventDefault();
    const title = document.getElementById("title").value;
    const content = document.getElementById("content").value;
    const author = document.getElementById("author").value;
    const time = new Date().toLocaleString();
    const img = document.getElementById("preview").src || "";

    await db.collection("articles").add({ title, content, author, time, image: img });

    alert("‚úÖ –°—Ç–∞—Ç—Ç—è –¥–æ–¥–∞–Ω–∞!");
    document.getElementById("articleForm").reset();
    document.getElementById("preview").classList.add("hidden");
    loadArticles();
    loadMyArticles();
  });

  // üîπ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤—Å—ñ—Ö —Å—Ç–∞—Ç–µ–π
  async function loadArticles() {
    const container = document.getElementById("articles");
    container.innerHTML = "";
    const snapshot = await db.collection("articles").orderBy("time","desc").get();
    snapshot.forEach(doc => {
      const art = doc.data();
      container.innerHTML += `
        <article>
          <h3>${art.title}</h3>
          ${art.image ? `<img src="${art.image}">` : ""}
          <p>${art.content}</p>
          <div class="meta">‚úç ${art.author} | üïí ${art.time}</div>
        </article>
      `;
    });
  }

  // üîπ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–∞—Ç–µ–π —É –∫–∞–±—ñ–Ω–µ—Ç—ñ
  async function loadMyArticles() {
    const container = document.getElementById("myArticles");
    container.innerHTML = "";
    const snapshot = await db.collection("articles").get();
    snapshot.forEach(doc => {
      const art = doc.data();
      container.innerHTML += `
        <article>
          <h4>${art.title}</h4>
          <button onclick="deleteArticle('${doc.id}')">‚ùå –í–∏–¥–∞–ª–∏—Ç–∏</button>
        </article>
      `;
    });
  }

  // üîπ –í–∏–¥–∞–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç—Ç—ñ
  async function deleteArticle(id) {
    if (confirm("–í–∏–¥–∞–ª–∏—Ç–∏ —Å—Ç–∞—Ç—Ç—é?")) {
      await db.collection("articles").doc(id).delete();
      loadArticles();
      loadMyArticles();
    }
  }
</script>
</body>
</html>
